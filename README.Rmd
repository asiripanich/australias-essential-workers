---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  echo = FALSE, 
  message = FALSE, 
  warning = FALSE
)
```

# australias-essential-workers

<!-- badges: start -->
<!-- badges: end -->

The goal of this repository is to identify essential workers by their ANZSIC and ANZSCO codes. Pull requests are welcome.

# Data sources

The original data sources of the spreadsheets in 'data' folder are as stated below.

- ANZSIC: https://www.fwc.gov.au/awards-and-agreements/minimum-wages-conditions/annual-wage-reviews/previous-wage-reviews/annual-wa-0
- ANZSCO: https://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/1220.02013,%20Version%201.3?OpenDocument

# References

- https://www.theaustralian.com.au/world/coronavirus-the-essential-workers-wholl-keep-australia-ticking-along/news-story/cb7992b6ae722afd0838f17e61338e01
- https://en.wikipedia.org/wiki/Essential_services
- https://www.betterteam.com/what-is-an-essential-worker-in-australia

# ANZSIC

```{r, echo = FALSE}
library(data.table)
library(readxl)
library(magrittr)
# library(gt)
library(kableExtra)

anzsic_codes <- 
  readxl::read_xlsx(path = "data/raw-data/ANZSIC.xlsx", sheet = "codes") %>%
  janitor::clean_names() %>% 
  setDT() %>% 
  .[, anzsic_class_title := trimws(anzsic_class_title)]

anzsic_divisions <- 
  readxl::read_xlsx(path = "data/raw-data/ANZSIC.xlsx", sheet = "divisions") %>%
  janitor::clean_names() %>%
  setDT() %>%
  .[, anzsic_division_title := trimws(anzsic_division_title)]

# gt(head(anzsic_divisions, 10)) %>%
#   tab_header(
#     title = "ANZSIC 2006 divisions"
#   )

kable(anzsic_divisions, 
      caption = "ANZSIC 2006 divisions")
  
# gt(head(anzsic_codes, 10)) %>%
#   tab_header(
#     title = "ANZSIC 2006 codes",
#     subtitle = "first 10 rows only"
#   ) 
  
kable(head(anzsic_codes, 10), 
    caption = "ANZSIC 2006 codes, first 10 rows only")
  # scroll_box(width = "500px", height = "200px")
```

# ANZSOC

```{r, echo = FALSE}
anzsoc <-
  readxl::read_xlsx(path = "data/raw-data/ANZSCO.xlsx", sheet = "Table 5", skip = 5, col_names = FALSE) %>%
  janitor::clean_names() %>%
  setDT(.)

anzsoc_major <-
  anzsoc %>%
  .[!is.na(x1) & !is.na(x2)] %>%
  janitor::remove_empty(., which = "cols") %>%
  setnames(c("major_code", "major_group"))

kable(anzsoc_major, 
    caption = "ANZSOC 2013 - Major group")

# gt(anzsoc_major) %>%
#   tab_header(
#     title = "ANZSOC 2013 - Major group"
#   )

anzsoc_submajor <-
  anzsoc %>%
  .[!is.na(x2) & !is.na(x3)] %>%
  janitor::remove_empty(., which = "cols") %>%
  setnames(c("submajor_code", "submajor_group"))

kable(head(anzsoc_submajor, 10), 
    caption = "ANZSOC 2013 - Sub-major group, first 10 rows only")

# gt(head(anzsoc_submajor, 10)) %>%
#   tab_header(
#     title = "ANZSOC 2013 - Submajor group",
#     subtitle = "first 10 rows only"
#   )

anzsoc_minor <-
  anzsoc %>%
  .[!is.na(x3) & !is.na(x4)] %>% 
  janitor::remove_empty(., which = "cols") %>%
  setnames(c("minor_code", "minor_group"))

kable(head(anzsoc_minor, 10), 
    caption = "ANZSOC 2013 - Minor group, first 10 rows only")

# gt(head(anzsoc_minor, 10)) %>%
#   tab_header(
#     title = "ANZSOC 2013 - Minor group",
#     subtitle = "first 10 rows only"
#   )

anzsoc_unit <-
  anzsoc %>%
  .[!is.na(x4) & !is.na(x5)] %>%
  janitor::remove_empty(., which = "cols") %>%
  setnames(c("unit_code", "unit_group"))

kable(head(anzsoc_unit, 10), 
    caption = "ANZSOC 2013 - Unit group, first 10 rows only")

# gt(head(anzsoc_unit, 10)) %>%
#   tab_header(
#     title = "ANZSOC 2013 - Unit group",
#     subtitle = "first 10 rows only"
#   )

anzsoc_occupation <-
  anzsoc %>%
  .[!is.na(x5) & !is.na(x6)] %>% 
  janitor::remove_empty(., which = "cols") %>% 
  setnames(c("occupation_code", "occupation_group", "skill_level"))

kable(head(anzsoc_unit, 10), 
    caption = "ANZSOC 2013 - Occupation, first 10 rows only")

# gt(head(anzsoc_occupation, 10)) %>%
#   tab_header(
#     title = "ANZSOC 2013 - Occupation",
#     subtitle = "first 10 rows only"
#   )

```

# Process tables

## ANZSIC

Merge ANZSIC tables together. `data/processed-data/cleaned_anzsic_2006.csv`

```{r}
anzsic_codes <- 
  anzsic_codes %>% 
  .[, anzsic_division := substr(anzsic_code, 1,1)] %>%
  merge(., anzsic_divisions, by = "anzsic_division")

data.table::fwrite(anzsic_codes, "data/processed-data/cleaned_anzsic_2006.csv")

kable(head(anzsic_codes, 10), caption = "ANZSIC 2006 table")
```

## ANZSOC

Merge ANZSOC tables together. See in `data/processed-data/cleaned_anzsoc_2013.csv`

```{r}
anzsoc_codes <-
  copy(anzsoc_occupation) %>%
  .[, `:=`(
    major_code = substr(occupation_code, 1, 1),
    submajor_code = substr(occupation_code, 1, 2),
    minor_code = substr(occupation_code, 1, 3),
    unit_code = substr(occupation_code, 1, 4)
  )] %>%
  merge(anzsoc_major, by = "major_code") %>% 
  merge(anzsoc_submajor, by = "submajor_code") %>% 
  merge(anzsoc_minor, by = "minor_code") %>%
  merge(anzsoc_unit, by = "unit_code") %>%
  setcolorder(c("major_code", "major_group", "submajor_code", "submajor_group", "minor_code", "minor_group", "unit_code", "unit_group"))

fwrite(anzsoc_codes, file = "data/processed-data/cleaned_anzsoc_2013.csv")

kable(head(anzsoc_codes, 10), caption = "ANZSOC 2013 table")
```

